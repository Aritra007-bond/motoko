STDLIB ?= ../src

OUTDIR=_out
MDofMO=./tools/markdown-of-motoko.py
MDofMD=./tools/markdown-of-markdown.py
PANDOC=pandoc


.PHONY: default all clean docMd docHtml

default: all

all: doc

clean:
	rm -rf $(OUTDIR)

#########################################################################################################33

##
## Documentation
##

doc: docMd docHtml

$(OUTDIR):
	@mkdir -p $@


$(OUTDIR)/%.md: $(STDLIB)/%.mo $(MDofMO) | $(OUTDIR)
	@echo "<!-- **[ Do not edit; This file was machine-generated on `date`. ]** -->" > $@
	@echo "" >> $@
	@echo "" >> $@
	$(MDofMO) $< >> $@

$(OUTDIR)/%.html: $(OUTDIR)/%.md
	$(PANDOC) -f gfm $^ > $@


DOCS = README prelude array buf option result hash list assocList trie trieSet

# Markdown documentation, extracted from the source directory
docMd: $(patsubst %,$(OUTDIR)/%.md,$(DOCS)) | $(OUTDIR)

# HTML documentation, extracted from the source directory
docHtml: $(patsubst %,$(OUTDIR)/%.html,$(DOCS)) | $(OUTDIR)

$(OUTDIR)/README.md: README.md | $(OUTDIR)
	@echo "<!-- **[ DO NOT EDIT -- GENERATED by a Makefile, on `date` ]** -->" > $@
	@echo "" >> $@
	$(MDofMD) $< >> $@
