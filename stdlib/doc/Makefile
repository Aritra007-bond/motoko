STDLIB ?= ../src

OUTDIR=_out
MDofMO=./tools/markdown-of-motoko.py
MDofMD=./tools/markdown-of-markdown.py
PANDOC=pandoc


.PHONY: default all clean docMd docHtml

default: all

all: doc

clean:
	rm -rf $(OUTDIR)

#########################################################################################################33

##
## Documentation
##

doc: docMd docHtml

$(OUTDIR):
	@mkdir -p $@


$(OUTDIR)/%.md: $(STDLIB)/%.mo $(MDofMO) | $(OUTDIR)
	@echo "<!-- **[ Do not edit; This file was machine-generated on `date`. ]** -->" > $@
	@echo "" >> $@
	@echo "" >> $@
	$(MDofMO) $< >> $@

$(OUTDIR)/%.html: $(OUTDIR)/%.md
	$(PANDOC) -f gfm $^ > $@


# Markdown documentation, extracted from the source directory
docMd: \
	$(OUTDIR)/README.md \
	$(OUTDIR)/prelude.md \
	$(OUTDIR)/array.md \
	$(OUTDIR)/buf.md \
	$(OUTDIR)/option.md \
	$(OUTDIR)/result.md \
	$(OUTDIR)/hash.md \
	$(OUTDIR)/list.md \
	$(OUTDIR)/assocList.md \
	$(OUTDIR)/trie.md \
	$(OUTDIR)/trieSet.md \
	$(OUTDIR)/docTable.md \
	| \
	$(OUTDIR)/ \

# HTML documentation, extracted from the source directory
docHtml: \
	$(OUTDIR)/README.html \
	$(OUTDIR)/prelude.html \
	$(OUTDIR)/array.html \
	$(OUTDIR)/buf.html \
	$(OUTDIR)/option.html \
	$(OUTDIR)/result.html \
	$(OUTDIR)/hash.html \
	$(OUTDIR)/list.html \
	$(OUTDIR)/assocList.html \
	$(OUTDIR)/trie.html \
	$(OUTDIR)/docTable.html \
	$(OUTDIR)/trieSet.html \
	| \
	$(OUTDIR)/ \

$(OUTDIR)/README.md: README.md | $(OUTDIR)
	@echo "<!-- **[ DO NOT EDIT -- GENERATED by a Makefile, on `date` ]** -->" > $@
	@echo "" >> $@
	$(MDofMD) $< >> $@
