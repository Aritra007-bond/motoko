ASC=../src/asc
DVM=dvm
OUTDIR=_out
DOCDIR=doc
MDofAS=./markdown-of-actorscript.py
MDofMD=./markdown-of-markdown.py
PANDOC=pandoc

WASM=\
  ProduceExchange\
	loadWorkloadAndQueryBig\

OUTFILES=$(addsuffix .out, $(TESTS)) $(addsuffix .wasm, $(WASM))

OUTPATHS=$(addprefix $(OUTDIR)/, $(OUTFILES))

.PHONY: default all clean alltests alldoc docMd docHtml profile-wasm profile-wasm-success profile-interp profile-interp-small

default: all

docmsg:
	@echo Begin building documentation in \`$(DOCDIR)\`...
	@echo $(HRULE)

alltests: $(OUTDIR) $(OUTPATHS)

all: alltests alldoc profile-wasm-success profile-interp-small

clean:
	rm -rf $(OUTDIR) $(DOCDIR)

$(OUTDIR):
	@mkdir $@

#########################################################################################################33

##
## Unit tests
##

# Add new module targets here:
TESTS=\
	Option \
	Result \
	Hash \
	List \
	ListTest \
	AssocList \
	Trie \
	DocTable \
	Set \
	SetDb \
	SetDbTest \
	ProduceExchange \
	producerRemInventory \
	retailerReserveMany \
	evalBulk \

$(OUTDIR)/Hash.out: hash.as | $(OUTDIR)
	$(ASC) -r $(filter-out $(OUTDIR), $^) > $@

$(OUTDIR)/Option.out: option.as | $(OUTDIR)
	$(ASC) -r $(filter-out $(OUTDIR), $^) > $@

$(OUTDIR)/Result.out: result.as | $(OUTDIR)
	$(ASC) -r $(filter-out $(OUTDIR), $^) > $@

$(OUTDIR)/List.out: list.as | $(OUTDIR)
	$(ASC) -r $(filter-out $(OUTDIR), $^) > $@

$(OUTDIR)/ListTest.out: listTest.as | $(OUTDIR)
	$(ASC) -r $(filter-out $(OUTDIR), $^) > $@

$(OUTDIR)/AssocList.out: assocList.as | $(OUTDIR)
	$(ASC) -r $(filter-out $(OUTDIR), $^) > $@

$(OUTDIR)/Trie.out: trie.as | $(OUTDIR)
	$(ASC) -r $(filter-out $(OUTDIR), $^) > $@

$(OUTDIR)/DocTable.out: docTable.as | $(OUTDIR)
	$(ASC) -r $(filter-out $(OUTDIR), $^) > $@

$(OUTDIR)/Set.out: set.as | $(OUTDIR)
	$(ASC) -r $(filter-out $(OUTDIR), $^) > $@

$(OUTDIR)/SetDb.out: setDb.as | $(OUTDIR)
	$(ASC) -r $(filter-out $(OUTDIR), $^) > $@

$(OUTDIR)/SetDbTest.out: setDbTest.as | $(OUTDIR)
	$(ASC) -r $(filter-out $(OUTDIR), $^) > $@

#########################################################################################################33

##
## PX Unit tests
##

PRODUCE_EXCHANGE_SRC=\
	prelude.as option.as hash.as list.as assocList.as trie.as docTable.as result.as \
	examples/produce-exchange/serverTypes.as \
	examples/produce-exchange/serverLang.as \
	examples/produce-exchange/serverModelTypes.as \
	examples/produce-exchange/serverModel.as \
	examples/produce-exchange/serverActor.as \

#########################################################################################################33

##
## Documentation
##

alldoc: docMd docHtml

# Markdown documentation, extracted from the source directory
docMd: \
	$(DOCDIR)/README.md \
	$(DOCDIR)/prelude.md \
	$(DOCDIR)/option.md \
	$(DOCDIR)/result.md \
	$(DOCDIR)/hash.md \
	$(DOCDIR)/list.md \
	$(DOCDIR)/assocList.md \
	$(DOCDIR)/trie.md \
	$(DOCDIR)/docTable.md \
	$(DOCDIR)/set.md \
	$(DOCDIR)/setDb.md \
	$(DOCDIR)/setDbTest.md \
	$(DOCDIR)/examples/produce-exchange/README.md \
	$(DOCDIR)/examples/produce-exchange/serverTypes.md \
	$(DOCDIR)/examples/produce-exchange/serverLang.md \
	$(DOCDIR)/examples/produce-exchange/serverActor.md \
	$(DOCDIR)/examples/produce-exchange/serverModelTypes.md \
	$(DOCDIR)/examples/produce-exchange/serverModel.md \
	| \
	$(DOCDIR)/ \
	$(DOCDIR)/examples/produce-exchange/

# HTML documentation, extracted from the source directory
docHtml: \
	$(DOCDIR)/README.html \
	$(DOCDIR)/prelude.html \
	$(DOCDIR)/option.html \
	$(DOCDIR)/result.html \
	$(DOCDIR)/hash.html \
	$(DOCDIR)/list.html \
	$(DOCDIR)/assocList.html \
	$(DOCDIR)/trie.html \
	$(DOCDIR)/docTable.html \
	$(DOCDIR)/set.html \
	$(DOCDIR)/setDb.html \
	$(DOCDIR)/setDbTest.html \
	$(DOCDIR)/examples/produce-exchange/README.html \
	$(DOCDIR)/examples/produce-exchange/serverTypes.html \
	$(DOCDIR)/examples/produce-exchange/serverLang.html \
	$(DOCDIR)/examples/produce-exchange/serverActor.html \
	$(DOCDIR)/examples/produce-exchange/serverModelTypes.html \
	$(DOCDIR)/examples/produce-exchange/serverModel.html \
	| \
	$(DOCDIR)/ \
	$(DOCDIR)/examples/produce-exchange/

$(DOCDIR):
	mkdir $@

$(DOCDIR)/README.md: README.md | $(DOCDIR)
	@echo "<!-- **[ DO NOT EDIT -- GENERATED by a Makefile, on `date` ]** -->" > $@
	@echo "" >> $@
	$(MDofMD) $< >> $@

$(DOCDIR)/examples/produce-exchange/: README.md
	@mkdir -p $@

$(DOCDIR)/examples/produce-exchange/README.md: examples/produce-exchange/README.md | $(DOCDIR)/examples/produce-exchange/
	@echo "<!-- **[ DO NOT EDIT -- GENERATED by a Makefile, on `date` ]** -->" > $@
	@echo "" >> $@
	$(MDofMD) $< >> $@

PRODUCE_EXCHANGE_SRC=\
	prelude.as option.as hash.as list.as assocList.as trie.as docTable.as result.as \
	examples/produce-exchange/serverTypes.as \
	examples/produce-exchange/serverLang.as \
	examples/produce-exchange/serverModelTypes.as \
	examples/produce-exchange/serverModel.as \
	examples/produce-exchange/serverActor.as \

$(OUTDIR)/ProduceExchange.out: $(PRODUCE_EXCHANGE_SRC) \
	examples/produce-exchange/test/simpleSetupAndQuery.as | $(OUTDIR)
	$(ASC) -r examples/produce-exchange/test/simpleSetupAndQuery.as > $@

$(OUTDIR)/retailerReserveMany.out: $(PRODUCE_EXCHANGE_SRC) \
	examples/produce-exchange/test/retailerReserveMany.as | $(OUTDIR)
	$(ASC) -r examples/produce-exchange/test/retailerReserveMany.as > $@

$(OUTDIR)/producerRemInventory.out: $(PRODUCE_EXCHANGE_SRC) \
	examples/produce-exchange/test/producerRemInventory.as | $(OUTDIR)
	$(ASC) -r examples/produce-exchange/test/producerRemInventory.as > $@

$(OUTDIR)/evalBulk.out: $(PRODUCE_EXCHANGE_SRC) \
	examples/produce-exchange/test/evalBulk.as | $(OUTDIR)
	$(ASC) -r examples/produce-exchange/test/evalBulk.as > $@

$(OUTDIR)/ProduceExchange.wasm: $(PRODUCE_EXCHANGE_SRC) | $(OUTDIR)
	$(ASC) -c -o $@ examples/produce-exchange/serverActor.as

$(DOCDIR)/%.md: %.as $(MDofAS) | $(DOCDIR)
	@echo "<!-- **[ Do not edit; This file was machine-generated on `date`. ]** -->" > $@
	@echo "" >> $@
	@echo "" >> $@
	$(MDofAS) $< >> $@

$(DOCDIR)/%.html: $(DOCDIR)/%.md
	$(PANDOC) -f gfm $^ > $@

#########################################################################################################33

##
## Profiling
##

# to do: Fix my Makefile targets below to make the file shorter; 
#        There is lot of redundancy, but I don't know how to hack the Makefile to overcome it without also making it too complex.

PROFILE_LOAD_SRC=\
	examples/produce-exchange/serverActor.as \
	examples/produce-exchange/test/profileLoad.as

PROFILE_LOAD_QUERY_SRC=\
	examples/produce-exchange/serverActor.as \
	examples/produce-exchange/test/profileLoadQuery.as

PROFILE_FIELDS=\
		--profile-field "hash_bit_length" \
		--profile-field "producer_count" \
		--profile-field "inventory_count" \
		--profile-field "transporter_count" \
		--profile-field "route_count" \
		--profile-field "retailer_join_count" \
		--profile-field "retailer_query_cost" \
		--profile-field "retailer_query_size_max" \

##
## To see the sizes of the workloads below, run `make profile-fast-counts`:
##

profile-fast-counts: \
	$(OUTDIR)/profileFastCounts.csv

$(OUTDIR)/profileFastCounts.csv: examples/produce-exchange/test/profileFastCounts.as
	$(ASC) -r examples/produce-exchange/test/profileFastCounts.as > $@


profile-interp-small: \
	$(OUTDIR)/profileLoadQuery.05-01.csv \
	$(OUTDIR)/profileLoadQuery.05-02.csv \
	$(OUTDIR)/profileLoadQuery.05-03.csv \

profile-interp: \
	$(OUTDIR)/profileLoadQuery.05-01.csv \
	$(OUTDIR)/profileLoadQuery.05-02.csv \
	$(OUTDIR)/profileLoadQuery.05-03.csv \
	$(OUTDIR)/profileLoadQuery.05-04.csv \
	$(OUTDIR)/profileLoadQuery.05-05.csv \
	$(OUTDIR)/profileLoadQuery.05-06.csv \
	$(OUTDIR)/profileLoadQuery.05-07.csv \
	$(OUTDIR)/profileLoadQuery.05-08.csv \
	$(OUTDIR)/profileLoadQuery.05-09.csv \
	$(OUTDIR)/profileLoadQuery.05-10.csv \
	$(OUTDIR)/profileLoadQuery.05-20.csv \
	$(OUTDIR)/profileLoadQuery.05-50.csv \
	$(OUTDIR)/profileLoadQuery.05-100.csv \

## AS wishlist: the following various targets each take a params file that defines two variables used in the common test file.
##              it would be better if we could accept named AS values as CLI params; that feature would obviate the need for the `param-X-Y.as` files used below:

$(OUTDIR)/profileLoadQuery.05-01.csv: $(PRODUCE_EXCHANGE_SRC) $(PROFILE_LOAD_QUERY_SRC) | $(OUTDIR)
	time $(ASC) -r --profile examples/produce-exchange/test/params-5-1.as $(PROFILE_LOAD_QUERY_SRC) --profile-file $@ $(PROFILE_FIELDS)

$(OUTDIR)/profileLoadQuery.05-02.csv: $(PRODUCE_EXCHANGE_SRC) $(PROFILE_LOAD_QUERY_SRC) | $(OUTDIR)
	time $(ASC) -r --profile examples/produce-exchange/test/params-5-2.as $(PROFILE_LOAD_QUERY_SRC) --profile-file $@ $(PROFILE_FIELDS)

$(OUTDIR)/profileLoadQuery.05-03.csv: $(PRODUCE_EXCHANGE_SRC) $(PROFILE_LOAD_QUERY_SRC) | $(OUTDIR)
	time $(ASC) -r --profile examples/produce-exchange/test/params-5-3.as $(PROFILE_LOAD_QUERY_SRC) --profile-file $@ $(PROFILE_FIELDS)

$(OUTDIR)/profileLoadQuery.05-04.csv: $(PRODUCE_EXCHANGE_SRC) $(PROFILE_LOAD_QUERY_SRC) | $(OUTDIR)
	time $(ASC) -r --profile examples/produce-exchange/test/params-5-4.as $(PROFILE_LOAD_QUERY_SRC) --profile-file $@ $(PROFILE_FIELDS)

$(OUTDIR)/profileLoadQuery.05-05.csv: $(PRODUCE_EXCHANGE_SRC) $(PROFILE_LOAD_QUERY_SRC) | $(OUTDIR)
	time $(ASC) -r --profile examples/produce-exchange/test/params-5-5.as $(PROFILE_LOAD_QUERY_SRC) --profile-file $@ $(PROFILE_FIELDS)

$(OUTDIR)/profileLoadQuery.05-06.csv: $(PRODUCE_EXCHANGE_SRC) $(PROFILE_LOAD_QUERY_SRC) | $(OUTDIR)
	time $(ASC) -r --profile examples/produce-exchange/test/params-5-6.as $(PROFILE_LOAD_QUERY_SRC) --profile-file $@ $(PROFILE_FIELDS)

$(OUTDIR)/profileLoadQuery.05-07.csv: $(PRODUCE_EXCHANGE_SRC) $(PROFILE_LOAD_QUERY_SRC) | $(OUTDIR)
	time $(ASC) -r --profile examples/produce-exchange/test/params-5-7.as $(PROFILE_LOAD_QUERY_SRC) --profile-file $@ $(PROFILE_FIELDS)

$(OUTDIR)/profileLoadQuery.05-08.csv: $(PRODUCE_EXCHANGE_SRC) $(PROFILE_LOAD_QUERY_SRC) | $(OUTDIR)
	time $(ASC) -r --profile examples/produce-exchange/test/params-5-8.as $(PROFILE_LOAD_QUERY_SRC) --profile-file $@ $(PROFILE_FIELDS)

$(OUTDIR)/profileLoadQuery.05-09.csv: $(PRODUCE_EXCHANGE_SRC) $(PROFILE_LOAD_QUERY_SRC) | $(OUTDIR)
	time $(ASC) -r --profile examples/produce-exchange/test/params-5-9.as $(PROFILE_LOAD_QUERY_SRC) --profile-file $@ $(PROFILE_FIELDS)

$(OUTDIR)/profileLoadQuery.05-10.csv: $(PRODUCE_EXCHANGE_SRC) $(PROFILE_LOAD_QUERY_SRC) | $(OUTDIR)
	time $(ASC) -r --profile examples/produce-exchange/test/params-5-10.as $(PROFILE_LOAD_QUERY_SRC) --profile-file $@ $(PROFILE_FIELDS)

$(OUTDIR)/profileLoadQuery.05-20.csv: $(PRODUCE_EXCHANGE_SRC) $(PROFILE_LOAD_QUERY_SRC) | $(OUTDIR)
	time $(ASC) -r --profile examples/produce-exchange/test/params-5-20.as $(PROFILE_LOAD_QUERY_SRC) --profile-file $@ $(PROFILE_FIELDS)

$(OUTDIR)/profileLoadQuery.05-50.csv: $(PRODUCE_EXCHANGE_SRC) $(PROFILE_LOAD_QUERY_SRC) | $(OUTDIR)
	time $(ASC) -r --profile examples/produce-exchange/test/params-5-50.as $(PROFILE_LOAD_QUERY_SRC) --profile-file $@ $(PROFILE_FIELDS)

$(OUTDIR)/profileLoadQuery.05-100.csv: $(PRODUCE_EXCHANGE_SRC) $(PROFILE_LOAD_QUERY_SRC) | $(OUTDIR)
	time $(ASC) -r --profile examples/produce-exchange/test/params-5-100.as $(PROFILE_LOAD_QUERY_SRC) --profile-file $@ $(PROFILE_FIELDS)

# wasm binaries and time measurements for various-sized PX workloads
#
# these sizes all run without memory limitation issues; bigger sizes complain about growing memory
profile-wasm-success:\
	$(OUTDIR)/ProduceExchangeLoadQuery_5_1.wasm \
	$(OUTDIR)/ProduceExchangeLoadQuery_5_1.wasm.csv \
	\
	$(OUTDIR)/ProduceExchangeLoadQuery_5_2.wasm \
	$(OUTDIR)/ProduceExchangeLoadQuery_5_2.wasm.csv \
	\
	$(OUTDIR)/ProduceExchangeLoadQuery_5_3.wasm \
	$(OUTDIR)/ProduceExchangeLoadQuery_5_3.wasm.csv \
	\
	$(OUTDIR)/ProduceExchangeLoadQuery_5_4.wasm \
	$(OUTDIR)/ProduceExchangeLoadQuery_5_4.wasm.csv \
	\
	$(OUTDIR)/ProduceExchangeLoadQuery_5_5.wasm \
	$(OUTDIR)/ProduceExchangeLoadQuery_5_5.wasm.csv \
	\
	$(OUTDIR)/ProduceExchangeLoadQuery_5_6.wasm \
	$(OUTDIR)/ProduceExchangeLoadQuery_5_6.wasm.csv \
	\
	$(OUTDIR)/ProduceExchangeLoadQuery_5_7.wasm \
	$(OUTDIR)/ProduceExchangeLoadQuery_5_7.wasm.csv \
	\
	$(OUTDIR)/ProduceExchangeLoadQuery_5_8.wasm \
	$(OUTDIR)/ProduceExchangeLoadQuery_5_8.wasm.csv \
	\
	$(OUTDIR)/ProduceExchangeLoadQuery_5_9.wasm \
	$(OUTDIR)/ProduceExchangeLoadQuery_5_9.wasm.csv \

# wasm binaries and time measurements for various-sized PX workloads
profile-wasm:\
	$(OUTDIR)/ProduceExchangeLoadQuery_5_1.wasm \
	$(OUTDIR)/ProduceExchangeLoadQuery_5_1.wasm.csv \
	\
	$(OUTDIR)/ProduceExchangeLoadQuery_5_2.wasm \
	$(OUTDIR)/ProduceExchangeLoadQuery_5_2.wasm.csv \
	\
	$(OUTDIR)/ProduceExchangeLoadQuery_5_3.wasm \
	$(OUTDIR)/ProduceExchangeLoadQuery_5_3.wasm.csv \
	\
	$(OUTDIR)/ProduceExchangeLoadQuery_5_4.wasm \
	$(OUTDIR)/ProduceExchangeLoadQuery_5_4.wasm.csv \
	\
	$(OUTDIR)/ProduceExchangeLoadQuery_5_5.wasm \
	$(OUTDIR)/ProduceExchangeLoadQuery_5_5.wasm.csv \
	\
	$(OUTDIR)/ProduceExchangeLoadQuery_5_6.wasm \
	$(OUTDIR)/ProduceExchangeLoadQuery_5_6.wasm.csv \
	\
	$(OUTDIR)/ProduceExchangeLoadQuery_5_7.wasm \
	$(OUTDIR)/ProduceExchangeLoadQuery_5_7.wasm.csv \
	\
	$(OUTDIR)/ProduceExchangeLoadQuery_5_8.wasm \
	$(OUTDIR)/ProduceExchangeLoadQuery_5_8.wasm.csv \
	\
	$(OUTDIR)/ProduceExchangeLoadQuery_5_9.wasm \
	$(OUTDIR)/ProduceExchangeLoadQuery_5_9.wasm.csv \
	\
	$(OUTDIR)/ProduceExchangeLoadQuery_5_10.wasm \
	$(OUTDIR)/ProduceExchangeLoadQuery_5_10.wasm.csv \
	\
	$(OUTDIR)/ProduceExchangeLoadQuery_5_20.wasm \
	$(OUTDIR)/ProduceExchangeLoadQuery_5_20.wasm.csv \
	\
	$(OUTDIR)/ProduceExchangeLoadQuery_5_50.wasm \
	$(OUTDIR)/ProduceExchangeLoadQuery_5_50.wasm.csv \
	\
	$(OUTDIR)/ProduceExchangeLoadQuery_5_100.wasm \
	$(OUTDIR)/ProduceExchangeLoadQuery_5_100.wasm.csv \


$(OUTDIR)/ProduceExchangeLoadQuery_5_1.wasm: $(PRODUCE_EXCHANGE_SRC) | $(OUTDIR)
	$(ASC) -c -o $@ examples/produce-exchange/test/params-5-1.as examples/produce-exchange/profileActor.as

$(OUTDIR)/ProduceExchangeLoadQuery_5_2.wasm: $(PRODUCE_EXCHANGE_SRC) | $(OUTDIR)
	$(ASC) -c -o $@ examples/produce-exchange/test/params-5-2.as examples/produce-exchange/profileActor.as

$(OUTDIR)/ProduceExchangeLoadQuery_5_3.wasm: $(PRODUCE_EXCHANGE_SRC) | $(OUTDIR)
	$(ASC) -c -o $@ examples/produce-exchange/test/params-5-3.as examples/produce-exchange/profileActor.as

$(OUTDIR)/ProduceExchangeLoadQuery_5_4.wasm: $(PRODUCE_EXCHANGE_SRC) | $(OUTDIR)
	$(ASC) -c -o $@ examples/produce-exchange/test/params-5-4.as examples/produce-exchange/profileActor.as

$(OUTDIR)/ProduceExchangeLoadQuery_5_5.wasm: $(PRODUCE_EXCHANGE_SRC) | $(OUTDIR)
	$(ASC) -c -o $@ examples/produce-exchange/test/params-5-5.as examples/produce-exchange/profileActor.as

$(OUTDIR)/ProduceExchangeLoadQuery_5_6.wasm: $(PRODUCE_EXCHANGE_SRC) | $(OUTDIR)
	$(ASC) -c -o $@ examples/produce-exchange/test/params-5-6.as examples/produce-exchange/profileActor.as

$(OUTDIR)/ProduceExchangeLoadQuery_5_7.wasm: $(PRODUCE_EXCHANGE_SRC) | $(OUTDIR)
	$(ASC) -c -o $@ examples/produce-exchange/test/params-5-7.as examples/produce-exchange/profileActor.as

$(OUTDIR)/ProduceExchangeLoadQuery_5_8.wasm: $(PRODUCE_EXCHANGE_SRC) | $(OUTDIR)
	$(ASC) -c -o $@ examples/produce-exchange/test/params-5-8.as examples/produce-exchange/profileActor.as

$(OUTDIR)/ProduceExchangeLoadQuery_5_9.wasm: $(PRODUCE_EXCHANGE_SRC) | $(OUTDIR)
	$(ASC) -c -o $@ examples/produce-exchange/test/params-5-9.as examples/produce-exchange/profileActor.as

$(OUTDIR)/ProduceExchangeLoadQuery_5_10.wasm: $(PRODUCE_EXCHANGE_SRC) | $(OUTDIR)
	$(ASC) -c -o $@ examples/produce-exchange/test/params-5-10.as examples/produce-exchange/profileActor.as

$(OUTDIR)/ProduceExchangeLoadQuery_5_20.wasm: $(PRODUCE_EXCHANGE_SRC) | $(OUTDIR)
	$(ASC) -c -o $@ examples/produce-exchange/test/params-5-20.as examples/produce-exchange/profileActor.as

$(OUTDIR)/ProduceExchangeLoadQuery_5_50.wasm: $(PRODUCE_EXCHANGE_SRC) | $(OUTDIR)
	$(ASC) -c -o $@ examples/produce-exchange/test/params-5-50.as examples/produce-exchange/profileActor.as

$(OUTDIR)/ProduceExchangeLoadQuery_5_100.wasm: $(PRODUCE_EXCHANGE_SRC) | $(OUTDIR)
	$(ASC) -c -o $@ examples/produce-exchange/test/params-5-100.as examples/produce-exchange/profileActor.as


$(OUTDIR)/time: time.c
	gcc time.c -o $@

$(OUTDIR)/ProduceExchangeLoadQuery_5_1.wasm.csv: $(OUTDIR)/ProduceExchangeLoadQuery_5_1.wasm $(OUTDIR)/time
	rm -rf ./.dvm
	$(DVM) reset
	$(DVM) new $(OUTDIR)/ProduceExchangeLoadQuery_5_1.wasm
	$(OUTDIR)/time "$(DVM) run 1 start " "5, 1, " > $@
	cat $@

$(OUTDIR)/ProduceExchangeLoadQuery_5_2.wasm.csv: $(OUTDIR)/ProduceExchangeLoadQuery_5_2.wasm $(OUTDIR)/time
	rm -rf ./.dvm
	$(DVM) reset
	$(DVM) new $(OUTDIR)/ProduceExchangeLoadQuery_5_2.wasm
	$(OUTDIR)/time "$(DVM) run 1 start " "5, 2, " > $@
	cat $@

$(OUTDIR)/ProduceExchangeLoadQuery_5_3.wasm.csv: $(OUTDIR)/ProduceExchangeLoadQuery_5_3.wasm $(OUTDIR)/time
	rm -rf ./.dvm
	$(DVM) reset
	$(DVM) new $(OUTDIR)/ProduceExchangeLoadQuery_5_3.wasm
	$(OUTDIR)/time "$(DVM) run 1 start " "5, 3, " > $@
	cat $@

$(OUTDIR)/ProduceExchangeLoadQuery_5_4.wasm.csv: $(OUTDIR)/ProduceExchangeLoadQuery_5_4.wasm $(OUTDIR)/time
	rm -rf ./.dvm
	$(DVM) reset
	$(DVM) new $(OUTDIR)/ProduceExchangeLoadQuery_5_4.wasm
	$(OUTDIR)/time "$(DVM) run 1 start " "5, 4, " > $@
	cat $@

$(OUTDIR)/ProduceExchangeLoadQuery_5_5.wasm.csv: $(OUTDIR)/ProduceExchangeLoadQuery_5_5.wasm $(OUTDIR)/time
	rm -rf ./.dvm
	$(DVM) reset
	$(DVM) new $(OUTDIR)/ProduceExchangeLoadQuery_5_5.wasm
	$(OUTDIR)/time "$(DVM) run 1 start " "5, 5, " > $@
	cat $@

$(OUTDIR)/ProduceExchangeLoadQuery_5_6.wasm.csv: $(OUTDIR)/ProduceExchangeLoadQuery_5_6.wasm $(OUTDIR)/time
	rm -rf ./.dvm
	$(DVM) reset
	$(DVM) new $(OUTDIR)/ProduceExchangeLoadQuery_5_6.wasm
	$(OUTDIR)/time "$(DVM) run 1 start " "5, 6, " > $@
	cat $@

$(OUTDIR)/ProduceExchangeLoadQuery_5_7.wasm.csv: $(OUTDIR)/ProduceExchangeLoadQuery_5_7.wasm $(OUTDIR)/time
	rm -rf ./.dvm
	$(DVM) reset
	$(DVM) new $(OUTDIR)/ProduceExchangeLoadQuery_5_7.wasm
	$(OUTDIR)/time "$(DVM) run 1 start " "5, 7, " > $@
	cat $@

$(OUTDIR)/ProduceExchangeLoadQuery_5_8.wasm.csv: $(OUTDIR)/ProduceExchangeLoadQuery_5_8.wasm $(OUTDIR)/time
	rm -rf ./.dvm
	$(DVM) reset
	$(DVM) new $(OUTDIR)/ProduceExchangeLoadQuery_5_8.wasm
	$(OUTDIR)/time "$(DVM) run 1 start " "5, 8, " > $@
	cat $@

$(OUTDIR)/ProduceExchangeLoadQuery_5_9.wasm.csv: $(OUTDIR)/ProduceExchangeLoadQuery_5_9.wasm $(OUTDIR)/time
	rm -rf ./.dvm
	$(DVM) reset
	$(DVM) new $(OUTDIR)/ProduceExchangeLoadQuery_5_5.wasm
	$(OUTDIR)/time "$(DVM) run 1 start " "5, 9, " > $@
	cat $@

$(OUTDIR)/ProduceExchangeLoadQuery_5_10.wasm.csv: $(OUTDIR)/ProduceExchangeLoadQuery_5_10.wasm $(OUTDIR)/time
	rm -rf ./.dvm
	$(DVM) reset
	$(DVM) new $(OUTDIR)/ProduceExchangeLoadQuery_5_10.wasm
	$(OUTDIR)/time "$(DVM) run 1 start " "5, 10, " > $@
	cat $@

$(OUTDIR)/ProduceExchangeLoadQuery_5_20.wasm.csv: $(OUTDIR)/ProduceExchangeLoadQuery_5_20.wasm $(OUTDIR)/time
	rm -rf ./.dvm
	$(DVM) reset
	$(DVM) new $(OUTDIR)/ProduceExchangeLoadQuery_5_20.wasm
	$(OUTDIR)/time "$(DVM) run 1 start " "5, 20, " > $@
	cat $@

$(OUTDIR)/ProduceExchangeLoadQuery_5_50.wasm.csv: $(OUTDIR)/ProduceExchangeLoadQuery_5_50.wasm $(OUTDIR)/time
	rm -rf ./.dvm
	$(DVM) reset
	$(DVM) new $(OUTDIR)/ProduceExchangeLoadQuery_5_50.wasm
	$(OUTDIR)/time "$(DVM) run 1 start " "5, 50, " > $@
	cat $@

$(OUTDIR)/ProduceExchangeLoadQuery_5_100.wasm.csv: $(OUTDIR)/ProduceExchangeLoadQuery_5_100.wasm $(OUTDIR)/time
	rm -rf ./.dvm
	$(DVM) reset
	$(DVM) new $(OUTDIR)/ProduceExchangeLoadQuery_5_100.wasm
	$(OUTDIR)/time "$(DVM) run 1 start " "5, 100, " > $@
	cat $@
